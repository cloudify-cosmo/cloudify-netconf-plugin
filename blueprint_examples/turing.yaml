tosca_definitions_version: cloudify_dsl_1_2

imports:
  - http://www.getcloudify.org/spec/cloudify/3.3/types.yaml
  - https://raw.githubusercontent.com/cloudify-cosmo/cloudify-netconf-plugin/master/plugin.yaml

node_types:

  turing-machine:
    derived_from: cloudify.netconf.nodes.xml_rpc
    properties:
      schema:
        default:
          turing-machine:
            description: "State data and configuration of a Turing Machine."
            keyword: container
            children:
              state:
                keyword: leaf
                type: state-index
                config: false
                mandatory: true
                description: "Current state of the control unit. The initial state is 0."
              head-position:
                keyword: leaf
                type: cell-index
                config: false
                mandatory: true
                description: "Position of tape read/write head."
              tape:
                keyword: container
                config: false
                description: "The contents of the tape."
                children:
                  cell:
                    keyword: list
                    key: coord
                    description: "List of non-blank cells."
                    children:
                      coord:
                        type: cell-index
                        keyword: leaf
                        description: "Coordinate (index) of the tape cell."
                      symbol:
                        keyword: leaf
                        type: tape-symbol
                        description: "Symbol appearing in the tape cell."
              transition-function:
                description: "The Turing Machine is configured by specifying the transition function."
                keyword: container
                children:
                  delta:
                    keyword: list
                    key: label
                    description: The list of transition rules.
                    children:
                        label:
                          keyword: leaf
                          type: string
                          description: "An arbitrary label of the transition rule."
                        input:
                          keyword: container
                          description: "Input parameters (arguments) of the transition rule."
                          children:
                            state:
                              type: state-index
                              keyword: leaf
                              description: "Current state of the control unit."
                            symbol:
                              type: tape-symbol
                              keyword: leaf
                              description: "Symbol read from the tape cell."
                        output:
                          keyword: container
                          description: "Output values of the transition rule."
                          children:
                            state:
                              type: state-index
                              keyword: leaf
                              description: "New state of the control unit. If this leaf is not present, the state doesn't change."
                            symbol:
                              type: tape-symbol
                              keyword: leaf
                              description: "Symbol to be written to the tape cell. If this leaf is not present, the symbol doesn't change."
                            head-move:
                              type: head-dir
                              keyword: leaf
                              description: "Move the head one cell to the left or right"
          initialize:
            keyword: rpc
            description: "Initialize the Turing Machine"
            input:
              tape-content:
                keyword: leaf
                type: string
                default: ""
                description: "The string with which the tape shall be initialized."
          run:
            keyword: rpc
            description: "Start the Turing Machine operation."
          halted:
            keyword: notification
            children:
              state:
                keyword: leaf
                type: state-index
                mandatory: true
                description: "The state of the control unit in which the machine has halted."
      metadata:
        default:
          xmlns:
            _: http://example.net/turing-machine
            t2: http://example.net/turing-machine/tape-2
          relax_ng: 'content of xml'
          scematron: 'content of xml'
          yang_files:
            - filename.yang
          features:
            - features list

  turing-machine-edit-config:
    derived_from: turing-machine
    properties:
      edit-config:
        default: {}

  turing-machine-initilize:
    derived_from: turing-machine
    properties:
      initialize:
        default: {}

# -------------------------------------------------------

node_templates:
  turing-machine-edit-config-impl:
    type: turing-machine-edit-config
    properties:
      edit-config:
        target: running
        config:
          turing-machine:
            transition-function:
              delta:
                - label: 1
                  input:
                    state: 0
                    symbol: 0
                  output:
                    state: 1
                    symbol: {}
                    head-move: right
                - label: 2
                  input:
                    state: 0
                    symbol: 1
                  output:
                    state: 1
                    symbol: 1
                    head-move: left
    interfaces:
      cloudify.interfaces.lifecycle:
        create:
          inputs:
            action: edit-config
            payload:  { get_property: [ turing-machine-edit-config-impl, edit-config ] }

  turing-machine-initilize-impl:
    type: turing-machine-initilize
    properties:
      initialize:
        input:
          tape-content: "0101010"
    interfaces:
      cloudify.interfaces.lifecycle:
        create:
          inputs:
            action: initialize
            payload:  { get_property: [ turing-machine-initilize-impl, initialize ] }
